
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Program Listing for File ImSequencer.cpp &#8212; LegionEngine v 0.2 alpha documentation</title>
    <link rel="stylesheet" href="../_static/nameko.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/collapsible-lists/css/tree_view.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
    <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Lora:400' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">LegionEngine v 0.2 alpha documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Program Listing for File ImSequencer.cpp</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="program-listing-for-file-imsequencer-cpp">
<span id="program-listing-file-home-runner-work-legion-engine-legion-engine-legion-engine-rendering-imgui-impl-imsequencer-cpp"></span><h1>Program Listing for File ImSequencer.cpp<a class="headerlink" href="#program-listing-for-file-imsequencer-cpp" title="Permalink to this headline">¶</a></h1>
<p>↰ <a class="reference internal" href="file__home_runner_work_Legion-Engine_Legion-Engine_legion_engine_rendering_imgui_impl_ImSequencer.cpp.html#file-home-runner-work-legion-engine-legion-engine-legion-engine-rendering-imgui-impl-imsequencer-cpp"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">/home/runner/work/Legion-Engine/Legion-Engine/legion/engine/rendering/imgui_impl/ImSequencer.cpp</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#ifndef _CRT_SECURE_NO_WARNINGS</span>
<span class="cp">#define _CRT_SECURE_NO_WARNINGS</span>
<span class="cp">#endif</span>

<span class="cp">#include</span> <span class="cpf">&lt;imgui/ImSequencer.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;imgui/imgui.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;imgui/imgui_internal.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp"></span>

<span class="k">namespace</span> <span class="n">imgui</span><span class="p">{</span>
<span class="k">namespace</span> <span class="n">sequencer</span>
<span class="p">{</span>
<span class="cp">#ifndef IMGUI_DEFINE_MATH_OPERATORS</span>
   <span class="k">static</span> <span class="n">ImVec2</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">ImVec2</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">b</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
   <span class="p">}</span>
<span class="cp">#endif</span>
   <span class="k">static</span> <span class="kt">bool</span> <span class="n">SequencerAddDelButton</span><span class="p">(</span><span class="n">ImDrawList</span><span class="o">*</span> <span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span> <span class="n">pos</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">add</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="n">ImGuiIO</span><span class="o">&amp;</span> <span class="n">io</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetIO</span><span class="p">();</span>
      <span class="n">ImRect</span> <span class="nf">delRect</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">16</span><span class="p">));</span>
      <span class="kt">bool</span> <span class="n">overDel</span> <span class="o">=</span> <span class="n">delRect</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">delColor</span> <span class="o">=</span> <span class="n">overDel</span> <span class="o">?</span> <span class="mh">0xFFAAAAAA</span> <span class="o">:</span> <span class="mh">0x50000000</span><span class="p">;</span>
      <span class="kt">float</span> <span class="n">midy</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5f</span><span class="p">;</span>
      <span class="kt">float</span> <span class="n">midx</span> <span class="o">=</span> <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5f</span><span class="p">;</span>
      <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRect</span><span class="p">(</span><span class="n">delRect</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">delRect</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">delColor</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
      <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">delRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">midy</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">delRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">midy</span><span class="p">),</span> <span class="n">delColor</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">add</span><span class="p">)</span>
         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">midx</span><span class="p">,</span> <span class="n">delRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">midx</span><span class="p">,</span> <span class="n">delRect</span><span class="p">.</span><span class="n">Max</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span> <span class="n">delColor</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">overDel</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">static</span> <span class="kt">int</span> <span class="n">min</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">)</span> <span class="o">?</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
   <span class="k">static</span> <span class="kt">int</span> <span class="n">max</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="o">?</span> <span class="nl">a</span> <span class="p">:</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>

   <span class="kt">bool</span> <span class="n">Sequencer</span><span class="p">(</span><span class="n">SequenceInterface</span><span class="o">*</span> <span class="n">sequence</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">currentFrame</span><span class="p">,</span> <span class="kt">bool</span><span class="o">*</span> <span class="n">expanded</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">selectedEntry</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span> <span class="n">firstFrame</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sequenceOptions</span><span class="p">)</span>
   <span class="p">{</span>
      <span class="kt">bool</span> <span class="n">ret</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="n">ImGuiIO</span><span class="o">&amp;</span> <span class="n">io</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetIO</span><span class="p">();</span>
      <span class="kt">int</span> <span class="n">cx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
      <span class="kt">int</span> <span class="n">cy</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
      <span class="k">static</span> <span class="kt">float</span> <span class="n">framePixelWidth</span> <span class="o">=</span> <span class="mf">10.f</span><span class="p">;</span>
      <span class="k">static</span> <span class="kt">float</span> <span class="n">framePixelWidthTarget</span> <span class="o">=</span> <span class="mf">10.f</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">legendWidth</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>

      <span class="k">static</span> <span class="kt">int</span> <span class="n">movingEntry</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">static</span> <span class="kt">int</span> <span class="n">movingPos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="k">static</span> <span class="kt">int</span> <span class="n">movingPart</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">delEntry</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">dupEntry</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">ItemHeight</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

      <span class="kt">bool</span> <span class="n">popupOpened</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">sequenceCount</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetItemCount</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sequenceCount</span><span class="p">)</span>
         <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="n">ImGui</span><span class="o">::</span><span class="n">BeginGroup</span><span class="p">();</span>

      <span class="n">ImDrawList</span><span class="o">*</span> <span class="n">draw_list</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetWindowDrawList</span><span class="p">();</span>
      <span class="n">ImVec2</span> <span class="n">canvas_pos</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetCursorScreenPos</span><span class="p">();</span>            <span class="c1">// ImDrawList API uses screen coordinates!</span>
      <span class="n">ImVec2</span> <span class="n">canvas_size</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetContentRegionAvail</span><span class="p">();</span>        <span class="c1">// Resize canvas to what&#39;s available</span>
      <span class="kt">int</span> <span class="n">firstFrameUsed</span> <span class="o">=</span> <span class="n">firstFrame</span> <span class="o">?</span> <span class="o">*</span><span class="nl">firstFrame</span> <span class="p">:</span> <span class="mi">0</span><span class="p">;</span>


      <span class="kt">int</span> <span class="n">controlHeight</span> <span class="o">=</span> <span class="n">sequenceCount</span> <span class="o">*</span> <span class="n">ItemHeight</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sequenceCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="n">controlHeight</span> <span class="o">+=</span> <span class="kt">int</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetCustomHeight</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
      <span class="kt">int</span> <span class="n">frameCount</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">()</span> <span class="o">-</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">(),</span> <span class="mi">1</span><span class="p">);</span>

      <span class="k">static</span> <span class="kt">bool</span> <span class="n">MovingScrollBar</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">static</span> <span class="kt">bool</span> <span class="n">MovingCurrentFrame</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">struct</span> <span class="n">CustomDraw</span>
      <span class="p">{</span>
         <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>
         <span class="n">ImRect</span> <span class="n">customRect</span><span class="p">;</span>
         <span class="n">ImRect</span> <span class="n">legendRect</span><span class="p">;</span>
         <span class="n">ImRect</span> <span class="n">clippingRect</span><span class="p">;</span>
         <span class="n">ImRect</span> <span class="n">legendClippingRect</span><span class="p">;</span>
      <span class="p">};</span>
      <span class="n">ImVector</span><span class="o">&lt;</span><span class="n">CustomDraw</span><span class="o">&gt;</span> <span class="n">customDraws</span><span class="p">;</span>
      <span class="n">ImVector</span><span class="o">&lt;</span><span class="n">CustomDraw</span><span class="o">&gt;</span> <span class="n">compactCustomDraws</span><span class="p">;</span>
      <span class="c1">// zoom in/out</span>
      <span class="kt">int</span> <span class="n">frameOverCursor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">const</span> <span class="kt">int</span> <span class="n">visibleFrameCount</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">floorf</span><span class="p">((</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">legendWidth</span><span class="p">)</span> <span class="o">/</span> <span class="n">framePixelWidth</span><span class="p">);</span>
      <span class="k">const</span> <span class="kt">float</span> <span class="n">barWidthRatio</span> <span class="o">=</span> <span class="n">ImMin</span><span class="p">(</span><span class="n">visibleFrameCount</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">frameCount</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>
      <span class="k">const</span> <span class="kt">float</span> <span class="n">barWidthInPixels</span> <span class="o">=</span> <span class="n">barWidthRatio</span> <span class="o">*</span> <span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">legendWidth</span><span class="p">);</span>

      <span class="n">ImRect</span> <span class="nf">regionRect</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">,</span> <span class="n">canvas_pos</span> <span class="o">+</span> <span class="n">canvas_size</span><span class="p">);</span>

      <span class="k">static</span> <span class="kt">bool</span> <span class="n">panningView</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">static</span> <span class="n">ImVec2</span> <span class="n">panningViewSource</span><span class="p">;</span>
      <span class="k">static</span> <span class="kt">int</span> <span class="n">panningViewFrame</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ImGui</span><span class="o">::</span><span class="n">IsWindowFocused</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">KeyAlt</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="p">{</span>
         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">panningView</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="n">panningViewSource</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">;</span>
            <span class="n">panningView</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">panningViewFrame</span> <span class="o">=</span> <span class="o">*</span><span class="n">firstFrame</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="o">*</span><span class="n">firstFrame</span> <span class="o">=</span> <span class="n">panningViewFrame</span> <span class="o">-</span> <span class="kt">int</span><span class="p">((</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">panningViewSource</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">framePixelWidth</span><span class="p">);</span>
         <span class="o">*</span><span class="n">firstFrame</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="o">*</span><span class="n">firstFrame</span><span class="p">,</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">(),</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">()</span> <span class="o">-</span> <span class="n">visibleFrameCount</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">panningView</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="p">{</span>
         <span class="n">panningView</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">framePixelWidthTarget</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">framePixelWidthTarget</span><span class="p">,</span> <span class="mf">0.1f</span><span class="p">,</span> <span class="mf">50.f</span><span class="p">);</span>

      <span class="n">framePixelWidth</span> <span class="o">=</span> <span class="n">ImLerp</span><span class="p">(</span><span class="n">framePixelWidth</span><span class="p">,</span> <span class="n">framePixelWidthTarget</span><span class="p">,</span> <span class="mf">0.33f</span><span class="p">);</span>

      <span class="n">frameCount</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">()</span> <span class="o">-</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">visibleFrameCount</span> <span class="o">&gt;=</span> <span class="n">frameCount</span> <span class="o">&amp;&amp;</span> <span class="n">firstFrame</span><span class="p">)</span>
         <span class="o">*</span><span class="n">firstFrame</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">();</span>


      <span class="c1">// --</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">expanded</span> <span class="o">&amp;&amp;</span> <span class="o">!*</span><span class="n">expanded</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="n">ImGui</span><span class="o">::</span><span class="n">InvisibleButton</span><span class="p">(</span><span class="s">&quot;canvas&quot;</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">ItemHeight</span><span class="p">));</span>
         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span><span class="p">),</span> <span class="mh">0xFF3D3837</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
         <span class="kt">char</span> <span class="n">tmps</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
         <span class="n">sprintf</span><span class="p">(</span><span class="n">tmps</span><span class="p">,</span> <span class="s">&quot;%d Frames / %d entries&quot;</span><span class="p">,</span> <span class="n">frameCount</span><span class="p">,</span> <span class="n">sequenceCount</span><span class="p">);</span>
         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">26</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="n">tmps</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
         <span class="kt">bool</span> <span class="n">hasScrollBar</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
         <span class="cm">/*</span>
<span class="cm">         int framesPixelWidth = int(frameCount * framePixelWidth);</span>
<span class="cm">         if ((framesPixelWidth + legendWidth) &gt;= canvas_size.x)</span>
<span class="cm">         {</span>
<span class="cm">             hasScrollBar = true;</span>
<span class="cm">         }</span>
<span class="cm">         */</span>
         <span class="c1">// test scroll area</span>
         <span class="n">ImVec2</span> <span class="nf">headerSize</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">ItemHeight</span><span class="p">);</span>
         <span class="n">ImVec2</span> <span class="nf">scrollBarSize</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mf">14.f</span><span class="p">);</span>
         <span class="n">ImGui</span><span class="o">::</span><span class="n">InvisibleButton</span><span class="p">(</span><span class="s">&quot;topBar&quot;</span><span class="p">,</span> <span class="n">headerSize</span><span class="p">);</span>
         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">,</span> <span class="n">canvas_pos</span> <span class="o">+</span> <span class="n">headerSize</span><span class="p">,</span> <span class="mh">0xFFFF0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
         <span class="n">ImVec2</span> <span class="n">childFramePos</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetCursorScreenPos</span><span class="p">();</span>
         <span class="n">ImVec2</span> <span class="nf">childFrameSize</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">canvas_size</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mf">8.f</span> <span class="o">-</span> <span class="n">headerSize</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">hasScrollBar</span> <span class="o">?</span> <span class="n">scrollBarSize</span><span class="p">.</span><span class="nl">y</span> <span class="p">:</span> <span class="mi">0</span><span class="p">));</span>
         <span class="n">ImGui</span><span class="o">::</span><span class="n">PushStyleColor</span><span class="p">(</span><span class="n">ImGuiCol_FrameBg</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
         <span class="n">ImGui</span><span class="o">::</span><span class="n">BeginChildFrame</span><span class="p">(</span><span class="mi">889</span><span class="p">,</span> <span class="n">childFrameSize</span><span class="p">);</span>
         <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">focused</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">IsWindowFocused</span><span class="p">();</span>
         <span class="n">ImGui</span><span class="o">::</span><span class="n">InvisibleButton</span><span class="p">(</span><span class="s">&quot;contentBar&quot;</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="kt">float</span><span class="p">(</span><span class="n">controlHeight</span><span class="p">)));</span>
         <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">contentMin</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetItemRectMin</span><span class="p">();</span>
         <span class="k">const</span> <span class="n">ImVec2</span> <span class="n">contentMax</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetItemRectMax</span><span class="p">();</span>
         <span class="k">const</span> <span class="n">ImRect</span> <span class="nf">contentRect</span><span class="p">(</span><span class="n">contentMin</span><span class="p">,</span> <span class="n">contentMax</span><span class="p">);</span>
         <span class="k">const</span> <span class="kt">float</span> <span class="n">contentHeight</span> <span class="o">=</span> <span class="n">contentMax</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

         <span class="c1">// full background</span>
         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">,</span> <span class="n">canvas_pos</span> <span class="o">+</span> <span class="n">canvas_size</span><span class="p">,</span> <span class="mh">0xFF242424</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

         <span class="c1">// current frame top</span>
         <span class="n">ImRect</span> <span class="nf">topRect</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span><span class="p">));</span>

         <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">MovingCurrentFrame</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">MovingScrollBar</span> <span class="o">&amp;&amp;</span> <span class="n">movingEntry</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">sequenceOptions</span> <span class="o">&amp;</span> <span class="n">SEQUENCER_CHANGE_FRAME</span> <span class="o">&amp;&amp;</span> <span class="n">currentFrame</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">currentFrame</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">topRect</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="p">{</span>
            <span class="n">MovingCurrentFrame</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
         <span class="p">}</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">MovingCurrentFrame</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">frameCount</span><span class="p">)</span>
            <span class="p">{</span>
               <span class="o">*</span><span class="n">currentFrame</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">topRect</span><span class="p">.</span><span class="n">Min</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">framePixelWidth</span><span class="p">)</span> <span class="o">+</span> <span class="n">firstFrameUsed</span><span class="p">;</span>
               <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">currentFrame</span> <span class="o">&lt;</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">())</span>
                  <span class="o">*</span><span class="n">currentFrame</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">();</span>
               <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">currentFrame</span> <span class="o">&gt;=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">())</span>
                  <span class="o">*</span><span class="n">currentFrame</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
               <span class="n">MovingCurrentFrame</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="c1">//header</span>
         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span><span class="p">),</span> <span class="mh">0xFF3D3837</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">sequenceOptions</span> <span class="o">&amp;</span> <span class="n">SEQUENCER_ADD</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">SequencerAddDelButton</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span> <span class="o">-</span> <span class="n">ItemHeight</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">true</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseReleased</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
               <span class="n">ImGui</span><span class="o">::</span><span class="n">OpenPopup</span><span class="p">(</span><span class="s">&quot;addEntry&quot;</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">ImGui</span><span class="o">::</span><span class="n">BeginPopup</span><span class="p">(</span><span class="s">&quot;addEntry&quot;</span><span class="p">))</span>
            <span class="p">{</span>
               <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetItemTypeCount</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">ImGui</span><span class="o">::</span><span class="n">Selectable</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetItemTypeName</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span>
                  <span class="p">{</span>
                     <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">Add</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                     <span class="o">*</span><span class="n">selectedEntry</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetItemCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                  <span class="p">}</span>

               <span class="n">ImGui</span><span class="o">::</span><span class="n">EndPopup</span><span class="p">();</span>
               <span class="n">popupOpened</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">}</span>

         <span class="c1">//header frame number and lines</span>
         <span class="kt">int</span> <span class="n">modFrameCount</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
         <span class="kt">int</span> <span class="n">frameStep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
         <span class="k">while</span> <span class="p">((</span><span class="n">modFrameCount</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">150</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="n">modFrameCount</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">frameStep</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
         <span class="p">};</span>
         <span class="kt">int</span> <span class="n">halfModFrameCount</span> <span class="o">=</span> <span class="n">modFrameCount</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

         <span class="k">auto</span> <span class="n">drawLine</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">regionHeight</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">baseIndex</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="n">modFrameCount</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">()</span> <span class="o">||</span> <span class="n">i</span> <span class="o">==</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">());</span>
            <span class="kt">bool</span> <span class="n">halfIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">halfModFrameCount</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="kt">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">)</span> <span class="o">+</span> <span class="n">legendWidth</span> <span class="o">-</span> <span class="kt">int</span><span class="p">(</span><span class="n">firstFrameUsed</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">tiretStart</span> <span class="o">=</span> <span class="n">baseIndex</span> <span class="o">?</span> <span class="mi">4</span> <span class="o">:</span> <span class="p">(</span><span class="n">halfIndex</span> <span class="o">?</span> <span class="mi">10</span> <span class="o">:</span> <span class="mi">14</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">tiretEnd</span> <span class="o">=</span> <span class="n">baseIndex</span> <span class="o">?</span> <span class="nl">regionHeight</span> <span class="p">:</span> <span class="n">ItemHeight</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">px</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">px</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span><span class="p">))</span>
            <span class="p">{</span>
               <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">px</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">tiretStart</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">px</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">tiretEnd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mh">0xFF606060</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

               <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">px</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">ItemHeight</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">px</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">regionHeight</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="mh">0x30606060</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">baseIndex</span> <span class="o">&amp;&amp;</span> <span class="n">px</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span><span class="p">))</span>
            <span class="p">{</span>
               <span class="kt">char</span> <span class="n">tmps</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
               <span class="n">sprintf</span><span class="p">(</span><span class="n">tmps</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
               <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">px</span> <span class="o">+</span> <span class="mf">3.f</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="mh">0xFFBBBBBB</span><span class="p">,</span> <span class="n">tmps</span><span class="p">);</span>
            <span class="p">}</span>

         <span class="p">};</span>

         <span class="k">auto</span> <span class="n">drawLineContent</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">regionHeight</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="kt">int</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">)</span> <span class="o">+</span> <span class="n">legendWidth</span> <span class="o">-</span> <span class="kt">int</span><span class="p">(</span><span class="n">firstFrameUsed</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">tiretStart</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">tiretEnd</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">contentMax</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">px</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">px</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span><span class="p">))</span>
            <span class="p">{</span>
               <span class="c1">//draw_list-&gt;AddLine(ImVec2((float)px, canvas_pos.y + (float)tiretStart), ImVec2((float)px, canvas_pos.y + (float)tiretEnd - 1), 0xFF606060, 1);</span>

               <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">px</span><span class="p">),</span> <span class="kt">float</span><span class="p">(</span><span class="n">tiretStart</span><span class="p">)),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">px</span><span class="p">),</span> <span class="kt">float</span><span class="p">(</span><span class="n">tiretEnd</span><span class="p">)),</span> <span class="mh">0x30606060</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
         <span class="p">};</span>
         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">();</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">frameStep</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="n">drawLine</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ItemHeight</span><span class="p">);</span>
         <span class="p">}</span>
         <span class="n">drawLine</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">(),</span> <span class="n">ItemHeight</span><span class="p">);</span>
         <span class="n">drawLine</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">(),</span> <span class="n">ItemHeight</span><span class="p">);</span>
         <span class="cm">/*</span>
<span class="cm">                  draw_list-&gt;AddLine(canvas_pos, ImVec2(canvas_pos.x, canvas_pos.y + controlHeight), 0xFF000000, 1);</span>
<span class="cm">                  draw_list-&gt;AddLine(ImVec2(canvas_pos.x, canvas_pos.y + ItemHeight), ImVec2(canvas_size.x, canvas_pos.y + ItemHeight), 0xFF000000, 1);</span>
<span class="cm">                  */</span>
                  <span class="c1">// clip content</span>

         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PushClipRect</span><span class="p">(</span><span class="n">childFramePos</span><span class="p">,</span> <span class="n">childFramePos</span> <span class="o">+</span> <span class="n">childFrameSize</span><span class="p">);</span>

         <span class="c1">// draw item names in the legend rect on the left</span>
         <span class="kt">size_t</span> <span class="n">customHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sequenceCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
            <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="nf">tpos</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">ItemHeight</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">customHeight</span><span class="p">);</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddText</span><span class="p">(</span><span class="n">tpos</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetItemLabel</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">sequenceOptions</span> <span class="o">&amp;</span> <span class="n">SEQUENCER_DEL</span><span class="p">)</span>
            <span class="p">{</span>
               <span class="kt">bool</span> <span class="n">overDel</span> <span class="o">=</span> <span class="n">SequencerAddDelButton</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span> <span class="o">-</span> <span class="n">ItemHeight</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">tpos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">false</span><span class="p">);</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">overDel</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseReleased</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                  <span class="n">delEntry</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>

               <span class="kt">bool</span> <span class="n">overDup</span> <span class="o">=</span> <span class="n">SequencerAddDelButton</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span> <span class="o">-</span> <span class="n">ItemHeight</span> <span class="o">-</span> <span class="n">ItemHeight</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">tpos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">true</span><span class="p">);</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">overDup</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseReleased</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                  <span class="n">dupEntry</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">customHeight</span> <span class="o">+=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetCustomHeight</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="c1">// clipping rect so items bars are not visible in the legend on the left when scrolled</span>
         <span class="c1">//</span>

         <span class="c1">// slots background</span>
         <span class="n">customHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sequenceCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0xFF3A3636</span> <span class="o">:</span> <span class="mh">0xFF413D3D</span><span class="p">;</span>

            <span class="kt">size_t</span> <span class="n">localCustomHeight</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetCustomHeight</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span><span class="p">,</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">customHeight</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">localCustomHeight</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">popupOpened</span> <span class="o">&amp;&amp;</span> <span class="n">cy</span> <span class="o">&gt;=</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">&amp;&amp;</span> <span class="n">cy</span> <span class="o">&lt;</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">ItemHeight</span> <span class="o">+</span> <span class="n">localCustomHeight</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">movingEntry</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">cx</span><span class="o">&gt;</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">cx</span> <span class="o">&lt;</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
            <span class="p">{</span>
               <span class="n">col</span> <span class="o">+=</span> <span class="mh">0x80201008</span><span class="p">;</span>
               <span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">-=</span> <span class="n">legendWidth</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">customHeight</span> <span class="o">+=</span> <span class="n">localCustomHeight</span><span class="p">;</span>
         <span class="p">}</span>

         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PushClipRect</span><span class="p">(</span><span class="n">childFramePos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">legendWidth</span><span class="p">),</span> <span class="mf">0.f</span><span class="p">),</span> <span class="n">childFramePos</span> <span class="o">+</span> <span class="n">childFrameSize</span><span class="p">);</span>

         <span class="c1">// vertical frame lines in content area</span>
         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">();</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">();</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">frameStep</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="n">drawLineContent</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="n">contentHeight</span><span class="p">));</span>
         <span class="p">}</span>
         <span class="n">drawLineContent</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">(),</span> <span class="kt">int</span><span class="p">(</span><span class="n">contentHeight</span><span class="p">));</span>
         <span class="n">drawLineContent</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">(),</span> <span class="kt">int</span><span class="p">(</span><span class="n">contentHeight</span><span class="p">));</span>

         <span class="c1">// selection</span>
         <span class="kt">bool</span> <span class="n">selected</span> <span class="o">=</span> <span class="n">selectedEntry</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="n">selectedEntry</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">selected</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="n">customHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">selectedEntry</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
               <span class="n">customHeight</span> <span class="o">+=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetCustomHeight</span><span class="p">(</span><span class="n">i</span><span class="p">);;</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">*</span> <span class="o">*</span><span class="n">selectedEntry</span> <span class="o">+</span> <span class="n">customHeight</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">selectedEntry</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">customHeight</span><span class="p">),</span> <span class="mh">0x801080FF</span><span class="p">,</span> <span class="mf">1.f</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="c1">// slots</span>
         <span class="n">customHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sequenceCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="kt">int</span><span class="o">*</span> <span class="n">start</span><span class="p">,</span> <span class="o">*</span> <span class="n">end</span><span class="p">;</span>
            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">color</span><span class="p">;</span>
            <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">start</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">color</span><span class="p">);</span>
            <span class="kt">size_t</span> <span class="n">localCustomHeight</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetCustomHeight</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>

            <span class="n">ImVec2</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span> <span class="o">-</span> <span class="n">firstFrameUsed</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">,</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">customHeight</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="nf">slotP1</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="o">*</span><span class="n">start</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="nf">slotP2</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="o">*</span><span class="n">end</span> <span class="o">*</span> <span class="n">framePixelWidth</span> <span class="o">+</span> <span class="n">framePixelWidth</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="nf">slotP3</span><span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="o">*</span><span class="n">end</span> <span class="o">*</span> <span class="n">framePixelWidth</span> <span class="o">+</span> <span class="n">framePixelWidth</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">localCustomHeight</span><span class="p">);</span>
            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slotColor</span> <span class="o">=</span> <span class="n">color</span> <span class="o">|</span> <span class="mh">0xFF000000</span><span class="p">;</span>
            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slotColorHalf</span> <span class="o">=</span> <span class="p">(</span><span class="n">color</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFF</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x40000000</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">slotP1</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">slotP2</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span><span class="p">))</span>
            <span class="p">{</span>
               <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">slotP1</span><span class="p">,</span> <span class="n">slotP3</span><span class="p">,</span> <span class="n">slotColorHalf</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
               <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">slotP1</span><span class="p">,</span> <span class="n">slotP2</span><span class="p">,</span> <span class="n">slotColor</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ImRect</span><span class="p">(</span><span class="n">slotP1</span><span class="p">,</span> <span class="n">slotP2</span><span class="p">).</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseDoubleClicked</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">{</span>
               <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">DoubleClick</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">ImRect</span> <span class="n">rects</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">slotP1</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">slotP1</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">framePixelWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">slotP2</span><span class="p">.</span><span class="n">y</span><span class="p">))</span>
                <span class="p">,</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">slotP2</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">framePixelWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">slotP1</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">slotP2</span><span class="p">)</span>
                <span class="p">,</span> <span class="n">ImRect</span><span class="p">(</span><span class="n">slotP1</span><span class="p">,</span> <span class="n">slotP2</span><span class="p">)</span> <span class="p">};</span>

            <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">quadColor</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="mh">0xFFFFFFFF</span><span class="p">,</span> <span class="n">slotColor</span> <span class="o">+</span> <span class="p">(</span><span class="n">selected</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mh">0x202020</span><span class="p">)</span> <span class="p">};</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">movingEntry</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">sequenceOptions</span> <span class="o">&amp;</span> <span class="n">SEQUENCER_EDIT_STARTEND</span><span class="p">))</span><span class="c1">// TODOFOCUS &amp;&amp; backgroundRect.Contains(io.MousePos))</span>
            <span class="p">{</span>
               <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">--</span><span class="p">)</span>
               <span class="p">{</span>
                  <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">rects</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">))</span>
                     <span class="k">continue</span><span class="p">;</span>
                  <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">rc</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">rc</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="n">quadColor</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">2</span><span class="p">);</span>
               <span class="p">}</span>

               <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
               <span class="p">{</span>
                  <span class="n">ImRect</span><span class="o">&amp;</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">rects</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">))</span>
                     <span class="k">continue</span><span class="p">;</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ImRect</span><span class="p">(</span><span class="n">childFramePos</span><span class="p">,</span> <span class="n">childFramePos</span> <span class="o">+</span> <span class="n">childFrameSize</span><span class="p">).</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">))</span>
                     <span class="k">continue</span><span class="p">;</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">ImGui</span><span class="o">::</span><span class="n">IsMouseClicked</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">MovingScrollBar</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">MovingCurrentFrame</span><span class="p">)</span>
                  <span class="p">{</span>
                     <span class="n">movingEntry</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
                     <span class="n">movingPos</span> <span class="o">=</span> <span class="n">cx</span><span class="p">;</span>
                     <span class="n">movingPart</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                     <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">BeginEdit</span><span class="p">(</span><span class="n">movingEntry</span><span class="p">);</span>
                     <span class="k">break</span><span class="p">;</span>
                  <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// custom draw</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">localCustomHeight</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
               <span class="n">ImVec2</span> <span class="n">rp</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">customHeight</span><span class="p">);</span>
               <span class="n">ImRect</span> <span class="nf">customRect</span><span class="p">(</span><span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">legendWidth</span> <span class="o">-</span> <span class="p">(</span><span class="n">firstFrameUsed</span> <span class="o">-</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5f</span><span class="p">)</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">,</span> <span class="kt">float</span><span class="p">(</span><span class="n">ItemHeight</span><span class="p">)),</span>
                  <span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">legendWidth</span> <span class="o">+</span> <span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">()</span> <span class="o">-</span> <span class="n">firstFrameUsed</span> <span class="o">-</span> <span class="mf">0.5f</span> <span class="o">+</span> <span class="mf">2.f</span><span class="p">)</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">,</span> <span class="kt">float</span><span class="p">(</span><span class="n">localCustomHeight</span> <span class="o">+</span> <span class="n">ItemHeight</span><span class="p">)));</span>
               <span class="n">ImRect</span> <span class="nf">clippingRect</span><span class="p">(</span><span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">legendWidth</span><span class="p">),</span> <span class="kt">float</span><span class="p">(</span><span class="n">ItemHeight</span><span class="p">)),</span> <span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="kt">float</span><span class="p">(</span><span class="n">localCustomHeight</span> <span class="o">+</span> <span class="n">ItemHeight</span><span class="p">)));</span>

               <span class="n">ImRect</span> <span class="nf">legendRect</span><span class="p">(</span><span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="kt">float</span><span class="p">(</span><span class="n">ItemHeight</span><span class="p">)),</span> <span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">legendWidth</span><span class="p">),</span> <span class="kt">float</span><span class="p">(</span><span class="n">localCustomHeight</span><span class="p">)));</span>
               <span class="n">ImRect</span> <span class="nf">legendClippingRect</span><span class="p">(</span><span class="n">canvas_pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="kt">float</span><span class="p">(</span><span class="n">ItemHeight</span><span class="p">)),</span> <span class="n">canvas_pos</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">legendWidth</span><span class="p">),</span> <span class="kt">float</span><span class="p">(</span><span class="n">localCustomHeight</span> <span class="o">+</span> <span class="n">ItemHeight</span><span class="p">)));</span>
               <span class="n">customDraws</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span> <span class="n">i</span><span class="p">,</span> <span class="n">customRect</span><span class="p">,</span> <span class="n">legendRect</span><span class="p">,</span> <span class="n">clippingRect</span><span class="p">,</span> <span class="n">legendClippingRect</span> <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
               <span class="n">ImVec2</span> <span class="n">rp</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">customHeight</span><span class="p">);</span>
               <span class="n">ImRect</span> <span class="nf">customRect</span><span class="p">(</span><span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">legendWidth</span> <span class="o">-</span> <span class="p">(</span><span class="n">firstFrameUsed</span> <span class="o">-</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5f</span><span class="p">)</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">,</span> <span class="kt">float</span><span class="p">(</span><span class="mf">0.f</span><span class="p">)),</span>
                  <span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">legendWidth</span> <span class="o">+</span> <span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">()</span> <span class="o">-</span> <span class="n">firstFrameUsed</span> <span class="o">-</span> <span class="mf">0.5f</span> <span class="o">+</span> <span class="mf">2.f</span><span class="p">)</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">,</span> <span class="kt">float</span><span class="p">(</span><span class="n">ItemHeight</span><span class="p">)));</span>
               <span class="n">ImRect</span> <span class="nf">clippingRect</span><span class="p">(</span><span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">legendWidth</span><span class="p">),</span> <span class="kt">float</span><span class="p">(</span><span class="mf">0.f</span><span class="p">)),</span> <span class="n">rp</span> <span class="o">+</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="kt">float</span><span class="p">(</span><span class="n">ItemHeight</span><span class="p">)));</span>

               <span class="n">compactCustomDraws</span><span class="p">.</span><span class="n">push_back</span><span class="p">({</span> <span class="n">i</span><span class="p">,</span> <span class="n">customRect</span><span class="p">,</span> <span class="n">ImRect</span><span class="p">(),</span> <span class="n">clippingRect</span><span class="p">,</span> <span class="n">ImRect</span><span class="p">()</span> <span class="p">});</span>
            <span class="p">}</span>
            <span class="n">customHeight</span> <span class="o">+=</span> <span class="n">localCustomHeight</span><span class="p">;</span>
         <span class="p">}</span>


         <span class="c1">// moving</span>
         <span class="k">if</span> <span class="p">(</span><span class="cm">/*backgroundRect.Contains(io.MousePos) &amp;&amp; */</span><span class="n">movingEntry</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="n">ImGui</span><span class="o">::</span><span class="n">CaptureMouseFromApp</span><span class="p">();</span>
            <span class="kt">int</span> <span class="n">diffFrame</span> <span class="o">=</span> <span class="kt">int</span><span class="p">((</span><span class="n">cx</span> <span class="o">-</span> <span class="n">movingPos</span><span class="p">)</span> <span class="o">/</span> <span class="n">framePixelWidth</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">abs</span><span class="p">(</span><span class="n">diffFrame</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
               <span class="kt">int</span><span class="o">*</span> <span class="n">start</span><span class="p">,</span> <span class="o">*</span> <span class="n">end</span><span class="p">;</span>
               <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="n">movingEntry</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">start</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">end</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">selectedEntry</span><span class="p">)</span>
                  <span class="o">*</span><span class="n">selectedEntry</span> <span class="o">=</span> <span class="n">movingEntry</span><span class="p">;</span>
               <span class="kt">int</span><span class="o">&amp;</span> <span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">start</span><span class="p">;</span>
               <span class="kt">int</span><span class="o">&amp;</span> <span class="n">r</span> <span class="o">=</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">movingPart</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
                  <span class="n">l</span> <span class="o">+=</span> <span class="n">diffFrame</span><span class="p">;</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">movingPart</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span>
                  <span class="n">r</span> <span class="o">+=</span> <span class="n">diffFrame</span><span class="p">;</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">l</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
               <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">movingPart</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span>
                     <span class="n">r</span> <span class="o">-=</span> <span class="n">l</span><span class="p">;</span>
                  <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
               <span class="p">}</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">movingPart</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span>
                  <span class="n">l</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">movingPart</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">l</span><span class="p">)</span>
                  <span class="n">r</span> <span class="o">=</span> <span class="n">l</span><span class="p">;</span>
               <span class="n">movingPos</span> <span class="o">+=</span> <span class="kt">int</span><span class="p">(</span><span class="n">diffFrame</span> <span class="o">*</span> <span class="n">framePixelWidth</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">{</span>
               <span class="c1">// single select</span>
               <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">diffFrame</span> <span class="o">&amp;&amp;</span> <span class="n">movingPart</span> <span class="o">&amp;&amp;</span> <span class="n">selectedEntry</span><span class="p">)</span>
               <span class="p">{</span>
                  <span class="o">*</span><span class="n">selectedEntry</span> <span class="o">=</span> <span class="n">movingEntry</span><span class="p">;</span>
                  <span class="n">ret</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
               <span class="p">}</span>

               <span class="n">movingEntry</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
               <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">EndEdit</span><span class="p">();</span>
            <span class="p">}</span>
         <span class="p">}</span>

         <span class="c1">// cursor</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">currentFrame</span> <span class="o">&amp;&amp;</span> <span class="n">firstFrame</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">currentFrame</span> <span class="o">&gt;=</span> <span class="o">*</span><span class="n">firstFrame</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">currentFrame</span> <span class="o">&lt;=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">())</span>
         <span class="p">{</span>
            <span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">cursorWidth</span> <span class="o">=</span> <span class="mf">8.f</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">cursorOffset</span> <span class="o">=</span> <span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">currentFrame</span> <span class="o">-</span> <span class="n">firstFrameUsed</span><span class="p">)</span> <span class="o">*</span> <span class="n">framePixelWidth</span> <span class="o">+</span> <span class="n">framePixelWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">cursorWidth</span> <span class="o">*</span> <span class="mf">0.5f</span><span class="p">;</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddLine</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">cursorOffset</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">cursorOffset</span><span class="p">,</span> <span class="n">contentMax</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="mh">0xA02A2AFF</span><span class="p">,</span> <span class="n">cursorWidth</span><span class="p">);</span>
            <span class="kt">char</span> <span class="n">tmps</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
            <span class="n">sprintf</span><span class="p">(</span><span class="n">tmps</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">currentFrame</span><span class="p">);</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddText</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">cursorOffset</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="mh">0xFF2A2AFF</span><span class="p">,</span> <span class="n">tmps</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PopClipRect</span><span class="p">();</span>
         <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">PopClipRect</span><span class="p">();</span>

         <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">customDraw</span> <span class="p">:</span> <span class="n">customDraws</span><span class="p">)</span>
            <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">CustomDraw</span><span class="p">(</span><span class="n">customDraw</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">draw_list</span><span class="p">,</span> <span class="n">customDraw</span><span class="p">.</span><span class="n">customRect</span><span class="p">,</span> <span class="n">customDraw</span><span class="p">.</span><span class="n">legendRect</span><span class="p">,</span> <span class="n">customDraw</span><span class="p">.</span><span class="n">clippingRect</span><span class="p">,</span> <span class="n">customDraw</span><span class="p">.</span><span class="n">legendClippingRect</span><span class="p">);</span>
         <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">customDraw</span> <span class="p">:</span> <span class="n">compactCustomDraws</span><span class="p">)</span>
            <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">CustomDrawCompact</span><span class="p">(</span><span class="n">customDraw</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">draw_list</span><span class="p">,</span> <span class="n">customDraw</span><span class="p">.</span><span class="n">customRect</span><span class="p">,</span> <span class="n">customDraw</span><span class="p">.</span><span class="n">clippingRect</span><span class="p">);</span>

         <span class="c1">// copy paste</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">sequenceOptions</span> <span class="o">&amp;</span> <span class="n">SEQUENCER_COPYPASTE</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="n">ImRect</span> <span class="n">rectCopy</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
               <span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">100</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">-</span> <span class="mi">2</span><span class="p">));</span>
            <span class="kt">bool</span> <span class="n">inRectCopy</span> <span class="o">=</span> <span class="n">rectCopy</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">);</span>
            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">copyColor</span> <span class="o">=</span> <span class="n">inRectCopy</span> <span class="o">?</span> <span class="mh">0xFF1080FF</span> <span class="o">:</span> <span class="mh">0xFF000000</span><span class="p">;</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddText</span><span class="p">(</span><span class="n">rectCopy</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">copyColor</span><span class="p">,</span> <span class="s">&quot;Copy&quot;</span><span class="p">);</span>

            <span class="n">ImRect</span> <span class="nf">rectPaste</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">140</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
               <span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">contentMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">140</span> <span class="o">+</span> <span class="mi">30</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">ItemHeight</span> <span class="o">-</span> <span class="mi">2</span><span class="p">));</span>
            <span class="kt">bool</span> <span class="n">inRectPaste</span> <span class="o">=</span> <span class="n">rectPaste</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">);</span>
            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pasteColor</span> <span class="o">=</span> <span class="n">inRectPaste</span> <span class="o">?</span> <span class="mh">0xFF1080FF</span> <span class="o">:</span> <span class="mh">0xFF000000</span><span class="p">;</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddText</span><span class="p">(</span><span class="n">rectPaste</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">pasteColor</span><span class="p">,</span> <span class="s">&quot;Paste&quot;</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">inRectCopy</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseReleased</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">{</span>
               <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">Copy</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">inRectPaste</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseReleased</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="p">{</span>
               <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">Paste</span><span class="p">();</span>
            <span class="p">}</span>
         <span class="p">}</span>
         <span class="c1">//</span>

         <span class="n">ImGui</span><span class="o">::</span><span class="n">EndChildFrame</span><span class="p">();</span>
         <span class="n">ImGui</span><span class="o">::</span><span class="n">PopStyleColor</span><span class="p">();</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">hasScrollBar</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="n">ImGui</span><span class="o">::</span><span class="n">InvisibleButton</span><span class="p">(</span><span class="s">&quot;scrollBar&quot;</span><span class="p">,</span> <span class="n">scrollBarSize</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="n">scrollBarMin</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetItemRectMin</span><span class="p">();</span>
            <span class="n">ImVec2</span> <span class="n">scrollBarMax</span> <span class="o">=</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">GetItemRectMax</span><span class="p">();</span>

            <span class="c1">// ratio = number of frames visible in control / number to total frames</span>

            <span class="kt">float</span> <span class="n">startFrameOffset</span> <span class="o">=</span> <span class="p">((</span><span class="kt">float</span><span class="p">)(</span><span class="n">firstFrameUsed</span> <span class="o">-</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">frameCount</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">legendWidth</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="nf">scrollBarA</span><span class="p">(</span><span class="n">scrollBarMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span><span class="p">,</span> <span class="n">scrollBarMin</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="nf">scrollBarB</span><span class="p">(</span><span class="n">scrollBarMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">scrollBarMax</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">scrollBarA</span><span class="p">,</span> <span class="n">scrollBarB</span><span class="p">,</span> <span class="mh">0xFF222222</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

            <span class="n">ImRect</span> <span class="nf">scrollBarRect</span><span class="p">(</span><span class="n">scrollBarA</span><span class="p">,</span> <span class="n">scrollBarB</span><span class="p">);</span>
            <span class="kt">bool</span> <span class="n">inScrollBar</span> <span class="o">=</span> <span class="n">scrollBarRect</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">);</span>

            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">scrollBarA</span><span class="p">,</span> <span class="n">scrollBarB</span><span class="p">,</span> <span class="mh">0xFF101010</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>


            <span class="n">ImVec2</span> <span class="nf">scrollBarC</span><span class="p">(</span><span class="n">scrollBarMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span> <span class="o">+</span> <span class="n">startFrameOffset</span><span class="p">,</span> <span class="n">scrollBarMin</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
            <span class="n">ImVec2</span> <span class="nf">scrollBarD</span><span class="p">(</span><span class="n">scrollBarMin</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">legendWidth</span> <span class="o">+</span> <span class="n">barWidthInPixels</span> <span class="o">+</span> <span class="n">startFrameOffset</span><span class="p">,</span> <span class="n">scrollBarMax</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">scrollBarC</span><span class="p">,</span> <span class="n">scrollBarD</span><span class="p">,</span> <span class="p">(</span><span class="n">inScrollBar</span> <span class="o">||</span> <span class="n">MovingScrollBar</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0xFF606060</span> <span class="o">:</span> <span class="mh">0xFF505050</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>

            <span class="kt">float</span> <span class="n">handleRadius</span> <span class="o">=</span> <span class="p">(</span><span class="n">scrollBarMax</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">scrollBarMin</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">ImRect</span> <span class="nf">barHandleLeft</span><span class="p">(</span><span class="n">scrollBarC</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">scrollBarC</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">14</span><span class="p">,</span> <span class="n">scrollBarD</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
            <span class="n">ImRect</span> <span class="nf">barHandleRight</span><span class="p">(</span><span class="n">ImVec2</span><span class="p">(</span><span class="n">scrollBarD</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="mi">14</span><span class="p">,</span> <span class="n">scrollBarC</span><span class="p">.</span><span class="n">y</span><span class="p">),</span> <span class="n">scrollBarD</span><span class="p">);</span>

            <span class="kt">bool</span> <span class="n">onLeft</span> <span class="o">=</span> <span class="n">barHandleLeft</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">);</span>
            <span class="kt">bool</span> <span class="n">onRight</span> <span class="o">=</span> <span class="n">barHandleRight</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">);</span>

            <span class="k">static</span> <span class="kt">bool</span> <span class="n">sizingRBar</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
            <span class="k">static</span> <span class="kt">bool</span> <span class="n">sizingLBar</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">barHandleLeft</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">barHandleLeft</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="p">(</span><span class="n">onLeft</span> <span class="o">||</span> <span class="n">sizingLBar</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0xFFAAAAAA</span> <span class="o">:</span> <span class="mh">0xFF666666</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
            <span class="n">draw_list</span><span class="o">-&gt;</span><span class="n">AddRectFilled</span><span class="p">(</span><span class="n">barHandleRight</span><span class="p">.</span><span class="n">Min</span><span class="p">,</span> <span class="n">barHandleRight</span><span class="p">.</span><span class="n">Max</span><span class="p">,</span> <span class="p">(</span><span class="n">onRight</span> <span class="o">||</span> <span class="n">sizingRBar</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0xFFAAAAAA</span> <span class="o">:</span> <span class="mh">0xFF666666</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>

            <span class="n">ImRect</span> <span class="nf">scrollBarThumb</span><span class="p">(</span><span class="n">scrollBarC</span><span class="p">,</span> <span class="n">scrollBarD</span><span class="p">);</span>
            <span class="k">static</span> <span class="k">const</span> <span class="kt">float</span> <span class="n">MinBarWidth</span> <span class="o">=</span> <span class="mf">44.f</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sizingRBar</span><span class="p">)</span>
            <span class="p">{</span>
               <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
               <span class="p">{</span>
                  <span class="n">sizingRBar</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
               <span class="p">}</span>
               <span class="k">else</span>
               <span class="p">{</span>
                  <span class="kt">float</span> <span class="n">barNewWidth</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">barWidthInPixels</span> <span class="o">+</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">MinBarWidth</span><span class="p">);</span>
                  <span class="kt">float</span> <span class="n">barRatio</span> <span class="o">=</span> <span class="n">barNewWidth</span> <span class="o">/</span> <span class="n">barWidthInPixels</span><span class="p">;</span>
                  <span class="n">framePixelWidthTarget</span> <span class="o">=</span> <span class="n">framePixelWidth</span> <span class="o">=</span> <span class="n">framePixelWidth</span> <span class="o">/</span> <span class="n">barRatio</span><span class="p">;</span>
                  <span class="kt">int</span> <span class="n">newVisibleFrameCount</span> <span class="o">=</span> <span class="kt">int</span><span class="p">((</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">legendWidth</span><span class="p">)</span> <span class="o">/</span> <span class="n">framePixelWidthTarget</span><span class="p">);</span>
                  <span class="kt">int</span> <span class="n">lastFrame</span> <span class="o">=</span> <span class="o">*</span><span class="n">firstFrame</span> <span class="o">+</span> <span class="n">newVisibleFrameCount</span><span class="p">;</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">lastFrame</span> <span class="o">&gt;</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">())</span>
                  <span class="p">{</span>
                     <span class="n">framePixelWidthTarget</span> <span class="o">=</span> <span class="n">framePixelWidth</span> <span class="o">=</span> <span class="p">(</span><span class="n">canvas_size</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">legendWidth</span><span class="p">)</span> <span class="o">/</span> <span class="kt">float</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">()</span> <span class="o">-</span> <span class="o">*</span><span class="n">firstFrame</span><span class="p">);</span>
                  <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sizingLBar</span><span class="p">)</span>
            <span class="p">{</span>
               <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
               <span class="p">{</span>
                  <span class="n">sizingLBar</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
               <span class="p">}</span>
               <span class="k">else</span>
               <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">fabsf</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">FLT_EPSILON</span><span class="p">)</span>
                  <span class="p">{</span>
                     <span class="kt">float</span> <span class="n">barNewWidth</span> <span class="o">=</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">barWidthInPixels</span> <span class="o">-</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseDelta</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">MinBarWidth</span><span class="p">);</span>
                     <span class="kt">float</span> <span class="n">barRatio</span> <span class="o">=</span> <span class="n">barNewWidth</span> <span class="o">/</span> <span class="n">barWidthInPixels</span><span class="p">;</span>
                     <span class="kt">float</span> <span class="n">previousFramePixelWidthTarget</span> <span class="o">=</span> <span class="n">framePixelWidthTarget</span><span class="p">;</span>
                     <span class="n">framePixelWidthTarget</span> <span class="o">=</span> <span class="n">framePixelWidth</span> <span class="o">=</span> <span class="n">framePixelWidth</span> <span class="o">/</span> <span class="n">barRatio</span><span class="p">;</span>
                     <span class="kt">int</span> <span class="n">newVisibleFrameCount</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">visibleFrameCount</span> <span class="o">/</span> <span class="n">barRatio</span><span class="p">);</span>
                     <span class="kt">int</span> <span class="n">newFirstFrame</span> <span class="o">=</span> <span class="o">*</span><span class="n">firstFrame</span> <span class="o">+</span> <span class="n">newVisibleFrameCount</span> <span class="o">-</span> <span class="n">visibleFrameCount</span><span class="p">;</span>
                     <span class="n">newFirstFrame</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="n">newFirstFrame</span><span class="p">,</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">(),</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">()</span> <span class="o">-</span> <span class="n">visibleFrameCount</span><span class="p">,</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">()));</span>
                     <span class="k">if</span> <span class="p">(</span><span class="n">newFirstFrame</span> <span class="o">==</span> <span class="o">*</span><span class="n">firstFrame</span><span class="p">)</span>
                     <span class="p">{</span>
                        <span class="n">framePixelWidth</span> <span class="o">=</span> <span class="n">framePixelWidthTarget</span> <span class="o">=</span> <span class="n">previousFramePixelWidthTarget</span><span class="p">;</span>
                     <span class="p">}</span>
                     <span class="k">else</span>
                     <span class="p">{</span>
                        <span class="o">*</span><span class="n">firstFrame</span> <span class="o">=</span> <span class="n">newFirstFrame</span><span class="p">;</span>
                     <span class="p">}</span>
                  <span class="p">}</span>
               <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
               <span class="k">if</span> <span class="p">(</span><span class="n">MovingScrollBar</span><span class="p">)</span>
               <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io</span><span class="p">.</span><span class="n">MouseDown</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                  <span class="p">{</span>
                     <span class="n">MovingScrollBar</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
                  <span class="p">}</span>
                  <span class="k">else</span>
                  <span class="p">{</span>
                     <span class="kt">float</span> <span class="n">framesPerPixelInBar</span> <span class="o">=</span> <span class="n">barWidthInPixels</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">visibleFrameCount</span><span class="p">;</span>
                     <span class="o">*</span><span class="n">firstFrame</span> <span class="o">=</span> <span class="kt">int</span><span class="p">((</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">panningViewSource</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">framesPerPixelInBar</span><span class="p">)</span> <span class="o">-</span> <span class="n">panningViewFrame</span><span class="p">;</span>
                     <span class="o">*</span><span class="n">firstFrame</span> <span class="o">=</span> <span class="n">ImClamp</span><span class="p">(</span><span class="o">*</span><span class="n">firstFrame</span><span class="p">,</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">(),</span> <span class="n">ImMax</span><span class="p">(</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMax</span><span class="p">()</span> <span class="o">-</span> <span class="n">visibleFrameCount</span><span class="p">,</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetFrameMin</span><span class="p">()));</span>
                  <span class="p">}</span>
               <span class="p">}</span>
               <span class="k">else</span>
               <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">scrollBarThumb</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">IsMouseClicked</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">firstFrame</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">MovingCurrentFrame</span> <span class="o">&amp;&amp;</span> <span class="n">movingEntry</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                  <span class="p">{</span>
                     <span class="n">MovingScrollBar</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                     <span class="n">panningViewSource</span> <span class="o">=</span> <span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">;</span>
                     <span class="n">panningViewFrame</span> <span class="o">=</span> <span class="o">-*</span><span class="n">firstFrame</span><span class="p">;</span>
                  <span class="p">}</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sizingRBar</span> <span class="o">&amp;&amp;</span> <span class="n">onRight</span> <span class="o">&amp;&amp;</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">IsMouseClicked</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                     <span class="n">sizingRBar</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sizingLBar</span> <span class="o">&amp;&amp;</span> <span class="n">onLeft</span> <span class="o">&amp;&amp;</span> <span class="n">ImGui</span><span class="o">::</span><span class="n">IsMouseClicked</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                     <span class="n">sizingLBar</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

               <span class="p">}</span>
            <span class="p">}</span>
         <span class="p">}</span>
      <span class="p">}</span>

      <span class="n">ImGui</span><span class="o">::</span><span class="n">EndGroup</span><span class="p">();</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">regionRect</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">))</span>
      <span class="p">{</span>
         <span class="kt">bool</span> <span class="n">overCustomDraw</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
         <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">custom</span> <span class="p">:</span> <span class="n">customDraws</span><span class="p">)</span>
         <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">custom</span><span class="p">.</span><span class="n">customRect</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">io</span><span class="p">.</span><span class="n">MousePos</span><span class="p">))</span>
            <span class="p">{</span>
               <span class="n">overCustomDraw</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span>
         <span class="p">}</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">overCustomDraw</span><span class="p">)</span>
         <span class="p">{</span>
         <span class="p">}</span>
         <span class="k">else</span>
         <span class="p">{</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">            frameOverCursor = *firstFrame + (int)(visibleFrameCount * ((io.MousePos.x - (float)legendWidth - canvas_pos.x) / (canvas_size.x - legendWidth)));</span>
<span class="c">            //frameOverCursor = max(min(*firstFrame - visibleFrameCount / 2, frameCount - visibleFrameCount), 0);</span>

<span class="c">            if (io.MouseWheel &lt; -FLT_EPSILON)</span>
<span class="c">            {</span>
<span class="c">               *firstFrame -= frameOverCursor;</span>
<span class="c">               *firstFrame = int(*firstFrame * 1.1f);</span>
<span class="c">               framePixelWidthTarget *= 0.9f;</span>
<span class="c">               *firstFrame += frameOverCursor;</span>
<span class="c">            }</span>

<span class="c">            if (io.MouseWheel &gt; FLT_EPSILON)</span>
<span class="c">            {</span>
<span class="c">               *firstFrame -= frameOverCursor;</span>
<span class="c">               *firstFrame = int(*firstFrame * 0.9f);</span>
<span class="c">               framePixelWidthTarget *= 1.1f;</span>
<span class="c">               *firstFrame += frameOverCursor;</span>
<span class="c">            }</span>
<span class="cp">#endif</span>
         <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">expanded</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="kt">bool</span> <span class="n">overExpanded</span> <span class="o">=</span> <span class="n">SequencerAddDelButton</span><span class="p">(</span><span class="n">draw_list</span><span class="p">,</span> <span class="n">ImVec2</span><span class="p">(</span><span class="n">canvas_pos</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">canvas_pos</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="o">!*</span><span class="n">expanded</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">overExpanded</span> <span class="o">&amp;&amp;</span> <span class="n">io</span><span class="p">.</span><span class="n">MouseReleased</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">*</span><span class="n">expanded</span> <span class="o">=</span> <span class="o">!*</span><span class="n">expanded</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">delEntry</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">Del</span><span class="p">(</span><span class="n">delEntry</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">selectedEntry</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*</span><span class="n">selectedEntry</span> <span class="o">==</span> <span class="n">delEntry</span> <span class="o">||</span> <span class="o">*</span><span class="n">selectedEntry</span> <span class="o">&gt;=</span> <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">GetItemCount</span><span class="p">()))</span>
            <span class="o">*</span><span class="n">selectedEntry</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">dupEntry</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">{</span>
         <span class="n">sequence</span><span class="o">-&gt;</span><span class="n">Duplicate</span><span class="p">(</span><span class="n">dupEntry</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation index</a><ul>
  </ul></li>
</ul>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/program_listing_file__home_runner_work_Legion-Engine_Legion-Engine_legion_engine_rendering_imgui_impl_ImSequencer.cpp.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
  </body>
</html>